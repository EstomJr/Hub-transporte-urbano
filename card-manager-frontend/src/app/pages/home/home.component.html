<div class="dashboard-container" *ngIf="role === 'ADMIN'; else userHome">
  <aside class="sidebar">
    <h2>Admin</h2>
    <button class="menu-button" (click)="setAdminSection('dashboard')">Dashboard</button>

    <div class="menu-group">
      <h4>Usuários</h4>
      <button class="menu-button" (click)="setAdminSection('users-list')">Listar usuários</button>
      <button class="menu-button" (click)="setAdminSection('users-add')">Adicionar usuários</button>
      <button class="menu-button" (click)="setAdminSection('users-update')">Alterar usuários</button>
      <button class="menu-button" (click)="setAdminSection('users-delete')">Excluir usuários</button>
    </div>

    <div class="menu-group">
      <h4>Cartões</h4>
      <button class="menu-button" (click)="setAdminSection('cards-list')">Listar cartões</button>
      <button class="menu-button" (click)="setAdminSection('cards-add')">Adicionar cartão</button>
      <button class="menu-button" (click)="setAdminSection('cards-delete')">Excluir cartão</button>
      <button class="menu-button" (click)="setAdminSection('cards-toggle')">Ativar/Inativar cartão</button>
</div>
  <button class="menu-button primary" (click)="setAdminSection('users-add')">Cadastrar novo usuário</button>
  <button class="menu-button logout-button" (click)="logout()">Sair</button>
  </aside>

  <main class="content">
    <div *ngIf="actionMessage" class="toast">{{ actionMessage }}</div>

    <section *ngIf="adminSection === 'dashboard'" class="dashboard-grid">
      <div class="stat-card">
        <h3>Total de usuários</h3>
        <p>{{ adminDashboard?.totalUsers ?? 0 }}</p>
      </div>
      <div class="stat-card">
        <h3>Total de cartões</h3>
        <p>{{ adminDashboard?.totalCards ?? 0 }}</p>
      </div>
      <div class="stat-card">
        <h3>Cartões ativos</h3>
        <p>{{ adminDashboard?.activeCards ?? 0 }}</p>
      </div>
      <div class="stat-card">
        <h3>Cartões inativos</h3>
        <p>{{ adminDashboard?.inactiveCards ?? 0 }}</p>
      </div>
    </section>

    <section *ngIf="adminSection === 'users-list'" class="panel">
      <h3>Usuários cadastrados</h3>
      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Nome</th>
              <th>Email</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of users">
              <td>{{ user.id }}</td>
              <td>{{ user.name }}</td>
              <td>{{ user.email }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section *ngIf="adminSection === 'users-add'" class="panel">
      <h3>Adicionar usuário</h3>
      <form [formGroup]="addUserForm" (ngSubmit)="submitAddUser()" class="form-grid">
        <input type="text" placeholder="Nome" formControlName="name" />
        <input type="email" placeholder="Email" formControlName="email" />
        <input type="password" placeholder="Senha" formControlName="password" />
        <select formControlName="role">
          <option value="USER">Usuário</option>
          <option value="ADMIN">Administrador</option>
        </select>
        <button type="submit" [disabled]="addUserForm.invalid">Cadastrar</button>
      </form>
    </section>

    <section *ngIf="adminSection === 'users-update'" class="panel">
      <h3>Alterar usuário</h3>
      <form [formGroup]="updateUserForm" (ngSubmit)="submitUpdateUser()" class="form-grid">
        <input type="number" placeholder="ID do usuário" formControlName="id" />
        <input type="text" placeholder="Nome" formControlName="name" />
        <input type="email" placeholder="Email" formControlName="email" />
        <input type="password" placeholder="Senha" formControlName="password" />
        <select formControlName="role">
          <option value="USER">Usuário</option>
          <option value="ADMIN">Administrador</option>
        </select>
        <button type="submit" [disabled]="updateUserForm.invalid">Salvar alterações</button>
      </form>
    </section>

    <section *ngIf="adminSection === 'users-delete'" class="panel">
      <h3>Excluir usuário</h3>
      <form [formGroup]="deleteUserForm" (ngSubmit)="submitDeleteUser()" class="form-grid">
        <input type="number" placeholder="ID do usuário" formControlName="id" />
        <button type="submit" [disabled]="deleteUserForm.invalid">Excluir</button>
      </form>
    </section>

    <section *ngIf="adminSection === 'cards-list'" class="panel">
      <h3>Cartões cadastrados</h3>
      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Número</th>
              <th>Nome</th>
              <th>Status</th>
              <th>Tipo</th>
              <th>Usuário</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let card of allCards">
              <td>{{ card.id }}</td>
              <td>{{ card.numeroCartao }}</td>
              <td>{{ card.nome }}</td>
              <td>{{ card.status ? 'Ativo' : 'Inativo' }}</td>
              <td>{{ card.tipoCartao }}</td>
              <td>{{ card.userId ?? '-' }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>
    <section *ngIf="adminSection === 'cards-add'" class="panel">
      <h3>Adicionar cartão para usuário</h3>
      <form [formGroup]="addAdminCardForm" (ngSubmit)="submitAddAdminCard()" class="form-grid">
        <input type="number" placeholder="ID do usuário" formControlName="userId" />
        <input type="text" placeholder="Número do cartão" formControlName="numeroCartao" />
        <input type="text" placeholder="Nome no cartão" formControlName="nome" />
        <select formControlName="tipoCartao">
          <option *ngFor="let tipo of cardTypes" [value]="tipo">{{ tipo }}</option>
        </select>
        <select formControlName="status">
          <option [ngValue]="true">Ativo</option>
          <option [ngValue]="false">Inativo</option>
        </select>
        <button type="submit" [disabled]="addAdminCardForm.invalid">Adicionar cartão</button>
      </form>
    </section>

    <section *ngIf="adminSection === 'cards-delete'" class="panel">
      <h3>Excluir cartão</h3>
      <form [formGroup]="deleteAdminCardForm" (ngSubmit)="submitDeleteAdminCard()" class="form-grid">
        <input type="number" placeholder="ID do usuário" formControlName="userId" />
        <input type="number" placeholder="ID do cartão" formControlName="cardId" />
        <button type="submit" [disabled]="deleteAdminCardForm.invalid">Excluir cartão</button>
      </form>
    </section>

    <section *ngIf="adminSection === 'cards-toggle'" class="panel">
      <h3>Ativar/Inativar cartão</h3>
      <form [formGroup]="toggleAdminCardForm" (ngSubmit)="submitToggleAdminCard()" class="form-grid">
        <input type="number" placeholder="ID do usuário" formControlName="userId" />
        <input type="number" placeholder="ID do cartão" formControlName="cardId" />
        <select formControlName="status">
          <option [ngValue]="true">Ativo</option>
          <option [ngValue]="false">Inativo</option>
        </select>
        <button type="submit" [disabled]="toggleAdminCardForm.invalid">Atualizar status</button>
      </form>
    </section>
  </main>
</div>

<ng-template #userHome>
  <div class="dashboard-container">
    <aside class="sidebar">
      <h2>Usuário</h2>
      <button class="menu-button" (click)="setUserSection('dashboard')">Bem-vindo</button>
      <button class="menu-button" (click)="setUserSection('profile')">Perfil do usuário</button>
      <button class="menu-button" (click)="setUserSection('profile-update')">Atualizar perfil</button>
      <button class="menu-button" (click)="setUserSection('cards')">Listar cartões</button>
      <button class="menu-button" (click)="setUserSection('add-card')">Adicionar cartão</button>
      <button class="menu-button logout-button" (click)="logout()">Sair</button>
    </aside>

    <main class="content">
      <div *ngIf="actionMessage" class="toast">{{ actionMessage }}</div>

      <section *ngIf="userSection === 'dashboard'" class="panel">
        <h3>Bem-vindo, {{ userProfile?.name || 'usuário' }}!</h3>
        <p>Confira o cartão cadastrado no seu perfil:</p>
        <div *ngIf="cartaoSelecionado" class="card-highlight">
          <div class="card-preview" [style.backgroundImage]="getImagem(cartaoSelecionado.tipoCartao)">
            <div class="card-number">{{ cartaoSelecionado.numeroCartao }}</div>
            <div class="card-name">{{ cartaoSelecionado.nome }}</div>
          </div>
          <div class="card-status">
            Status: <strong>{{ cartaoSelecionado.status ? 'Ativo' : 'Inativo' }}</strong>
          </div>
        </div>
        <p *ngIf="!cartaoSelecionado">Nenhum cartão cadastrado ainda.</p>
      </section>

      <section *ngIf="userSection === 'profile'" class="panel">
        <h3>Meu perfil</h3>
        <div class="profile-info">
          <p><strong>Nome:</strong> {{ userProfile?.name }}</p>
          <p><strong>Email:</strong> {{ userProfile?.email }}</p>
        </div>
      </section>

      <section *ngIf="userSection === 'profile-update'" class="panel">
        <h3>Atualizar perfil</h3>
        <form [formGroup]="updateProfileForm" (ngSubmit)="submitUpdateProfile()" class="form-grid">
          <input type="text" placeholder="Nome" formControlName="name" />
          <input type="email" placeholder="Email" formControlName="email" />
          <input type="password" placeholder="Senha" formControlName="password" />
          <button type="submit" [disabled]="updateProfileForm.invalid">Salvar</button>
        </form>
      </section>

      <section *ngIf="userSection === 'cards'" class="panel">
        <h3>Meus cartões</h3>
        <div *ngIf="cartoes.length > 0; else emptyState" class="cards-grid">
          <button
            type="button"
            class="card-item"
            *ngFor="let cartao of cartoes"
            (click)="selecionarCartao(cartao)"
            [class.selected]="cartaoSelecionado?.id === cartao.id"
          >
            <div class="card-preview" [style.backgroundImage]="getImagem(cartao.tipoCartao)">
              <div class="card-number">{{ cartao.numeroCartao }}</div>
              <div class="card-name">{{ cartao.nome }}</div>
            </div>
          </button>
        </div>

        <div class="card-details" *ngIf="cartaoSelecionado">
          <h4>Detalhes</h4>
          <div class="detail-row">
            <span>Tipo:</span>
            <strong>{{ cartaoSelecionado.tipoCartao }}</strong>
          </div>
          <div class="detail-row">
            <span>Status:</span>
            <strong>{{ cartaoSelecionado.status ? 'Ativo' : 'Inativo' }}</strong>
          </div>
          <div class="actions">
            <button type="button" (click)="bloquearOuDesbloquearCartao()">
              {{ cartaoSelecionado.status ? 'Inativar' : 'Ativar' }}
            </button>
            <button type="button" class="danger" (click)="excluirCartao()">Remover cartão</button>
          </div>
        </div>
      </section>

      <section *ngIf="userSection === 'add-card'" class="panel">
        <h3>Adicionar cartão</h3>
        <form [formGroup]="addUserCardForm" (ngSubmit)="submitAddUserCard()" class="form-grid">
          <input type="text" placeholder="Número do cartão" formControlName="numeroCartao" />
          <input type="text" placeholder="Nome no cartão" formControlName="nome" />
          <select formControlName="tipoCartao">
            <option *ngFor="let tipo of cardTypes" [value]="tipo">{{ tipo }}</option>
          </select>
          <select formControlName="status">
            <option [ngValue]="true">Ativo</option>
            <option [ngValue]="false">Inativo</option>
          </select>
          <button type="submit" [disabled]="addUserCardForm.invalid">Cadastrar cartão</button>
        </form>
      </section>
    </main>
  </div>
</ng-template>

<ng-template #emptyState>
  <p>Nenhum cartão encontrado.</p>
</ng-template>